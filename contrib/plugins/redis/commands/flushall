#!/bin/bash
SERVICE_NAME="$1"

echo "-----> Flushing all databases for $SERVICE_NAME"

# Source helper functions
source /opt/gokku/scripts/plugin-helpers.sh

# Check if container exists
if ! container_exists "$SERVICE_NAME"; then
    echo "Service '$SERVICE_NAME' not found"
    exit 1
fi

# Check if container is running
if ! container_is_running "$SERVICE_NAME"; then
    echo "Service '$SERVICE_NAME' is not running"
    exit 1
fi

# Get Redis password
REDIS_PASSWORD=$(get_service_config "$SERVICE_NAME" | grep -o '"password":"[^"]*"' | cut -d'"' -f4)

# Flush all databases
docker exec "$SERVICE_NAME" redis-cli --no-auth-warning -a "$REDIS_PASSWORD" FLUSHALL

echo "-----> All databases flushed successfully"
